version: '3.3'
services:
    adguard:
        container_name: ${SERVICE}
        restart: unless-stopped
        volumes:
            - '/var/lib/container/adguardhome/work:/opt/adguardhome/work'
            - '/var/lib/container/adguardhome/conf:/opt/adguardhome/conf'
        ports:
            - '53:53/tcp'
            - '53:53/udp'
            - '3000:3000/tcp' # for local access.
        image: adguard/adguardhome
        networks:
          - traefik
        labels:
          - traefik.enable=true
          - traefik.http.routers.${SERVICE}.rule=Host(`${DOMAIN}`)
          - traefik.http.routers.${SERVICE}.entrypoints=https
          - traefik.http.routers.${SERVICE}.tls.certresolver=letsencrypt
          - traefik.http.services.${SERVICE}.loadbalancer.server.port=${PORT}
          - traefik.http.routers.${SERVICE}.middlewares=authelia@docker
       
networks:
  traefik:
    name: traefik